<chapter id='faq'>
  <title>FAQ</title>

<qandaset>

<qandadiv><title>General Information</title>

<qandaentry id='faq_multipleservers'>
<question><para>Can I run several servers on the same machine ?</para></question>
<answer><para>
Yes ! You will need to have a separate config file for each instance (look the
-f option), and to specify at least different ports & shm key in each config file.
</para>
<para>
Remember wzdftp uses <emphasis>two</emphasis> shared memory zones, so do NOT
specify consecutive keys.
</para></answer>
</qandaentry>

<qandaentry id='faq_tls1'>
<question><para>When I start the server it displays no error but it isn't
running (not present in the process list)</para></question>
<answer><para>
Check your log file !
</para>
<para>
If your server is compiled with TLS enabled, the most frequent error an invalid
or absent certificate file. Error looks like:
</para>
<screen>
SSL_CTX_use_certificate_file() error:0906D06C:PEM routines:PEM_read_bio:no start line
TLS subsystem could not be initialized.
</screen>
</answer>
</qandaentry>

<qandaentry id='faq_fxp'>
<question><para>Site to site transfer (aka FXP) does not work
!</para></question>
<answer><para>
Before ANY complaint, please check that there are no firewall (hardware and/or
software) between the two servers. Keep in mind that most of the time FXP and
TLS are highly incompatible: firewall open dynamic ports by watching connection,
and trying to detect usage of PORT or PASV commands. If you run in TLS mode,
it is EVIDENT that the firewall will never detect the command (the connection
is encrypted), thus won't open dynamic ports.
</para>
<para>
NAT (Network Address Translation) can also be a cause of problems, please check
that the IP addresses send during port negotiation are correct.
</para>
<para>
When FXP fails, try to reverse passive and active sides of transfer: in FXP,
one server is in PASV mode, the other in PORT mode. Sometimes the connection
can fail in one direction and not in the other (often an effect of firewalls
or NAT).
</para></answer>
</qandaentry>

<qandaentry id='faq_links_vfs'>
<question><para>I want to give access to a directory on another disk, should I
choose symlinks or VFS ?
</para></question>
<answer><para>
In the general case, symlinks ! Symlinks are faster than VFS, can easily be
manipulated online and are clearly more flexible than VFS.
</para>
<para>
VFS should only be used when you have several users with different home
directories and want to easily give access to a special directory for all (e.g
show a INSTALL directory in each user's homedir).
</para>
<para>
Symlinks can also be manipulated with scripts.
</para></answer>
</qandaentry>


</qandadiv>

<qandadiv><title>Linux</title>

<qandaentry id='faq_shm'>
<question><para>Server dies with error 'CRITICAL: shm exists with selected shm_key
xxxxxx'</para></question>
<answer><para>
This means the server shared memory zone is already allocated, it can only
happen in two cases: last execution crashed, or another server is running.
</para>
<para>
To remove a zone resulting from a crash (this should never happen :) just run
(with options <emphasis>in the same order</emphasis>)
</para>
<screen>$PREFIX/sbin/wzdftpd -f $PREFIX/etc/wzdftpd/wzd.cfg -d</screen>
<para>
To run multiples instance of a ftp server look at <link linkend='faq_multipleservers'>
"Running multiples instances</link>.
</para>
<para>
You can also set the option <link linkend='cfg_force_shm_cleanup'>
<emphasis>force_shm_cleanup</emphasis></link> in the config file to
automatically try to delete shm - this option can be DANGEROUS !
</para></answer>
</qandaentry>

<qandaentry id='faq_shm2'>
<question><para>The precedent command (-d) does not work !</para></question>
<answer><para>
First of all, check that you have set option <filename>-f /path/to/configfile</filename>
 <emphasis>before</emphasis> option <filename>-d</filename>.
</para>
<para>
Else, let's play: get the id using
<screen>ipcs</screen> 
and remove memory zones using
<screen>ipcrm shm id</screen>
If the memory zone is still there after running that as root, call an exorcist
</para></answer>
</qandaentry>

<qandaentry id='faq_server_uid'>
<question><para>When I run the server with uid 0 (root) it complains it
can't open file 'users' or commit changes</para></question>
<answer><para>
Make sure files 'users' and 'users.OLD' are owned by same uid as specified in the
server_uid directive in the config file.
</para>
<screen>chown ftp users users.OLD</screen>
<para>
When running the server with root privileges, you can specify a server_uid line
in the config file to drop root privileges after binding to port < 1024.
Note that this server does not need root privileges to run, it is designed to
work in restricted user-mode (this is REALLY more secure !).
</para></answer>
</qandaentry>

</qandadiv>

<qandadiv><title>FreeBSD</title>

<qandaentry id='faq_shm_badsys'>
<question><para>I run wzdftpd and after that system says 'Bad system call(Core
dumped)'</para></question>
<answer><para>
It means you need to recompile your kernel with shared memory support.
</para></answer>
</qandaentry>

</qandadiv>

<qandadiv><title>Config and commands</title>

<qandaentry id='faq_customsite'>
<question><para>How do I add a custom site command ?</para></question>
<answer><para>
Add the definition to your config file:
<screen>ex: site_cmd = my_free /usr/local/bin/free.sh</screen>
</para>
<para>You will also need to authorize users to use the command:
<screen>ex: -site_my_free = *</screen>
</para></answer>
</qandaentry>

</qandadiv>

<qandadiv><title>Backends</title>

<qandaentry id='faq_edit_users'>
 <question><para>Can I edit the file 'users' ?</para></question>
 <answer><para>
 Yes, but carefully ! You must edit it offline (or the server will overwrite
 the file on next modification or at server exit).
 </para></answer>
</qandaentry>

</qandadiv>

</qandaset>

</chapter>
