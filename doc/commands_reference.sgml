<chapter>
<title>Commands Reference</title>

<variablelist>

<varlistentry id='site_addip'><term>site addip &lt;user&gt; &lt;ip&gt;</term>
<listitem>
<para>Add IP to  user.
<screen>site addip toto 127.*</screen>
This will allow user <quote>toto</quote> to connect from all ip
beggining by <quote>127.</quote>
</para>
<para><emphasis>NOTE: ident is currently NOT supported, but is planned for next
release</emphasis></para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_adduser'><term>site adduser &lt;user&gt; &lt;password&gt;
[&lt;group&gt;] [&lt;backend&gt;]</term>
<listitem>
<para>
Add a user, with and no allowed ip. If group is specified, user will be added to the group
(Note: only siteops can add users to a different group than their own group), otherwise
the main group of the current user will be used.
</para>
<para>
User's homedir is determined using the value 'default_home' of the group. A default ratio
is also set (1:3).
</para>
<para>
You MUST add an ip after.
<screen>ex: site adduser toto mypassword anonymous</screen>
</para>
<para>If you are a gadmin, you can only add users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_backend'><term>site backend &lt;command&gt;
&lt;backend_name&gt;</term>
<listitem>
<para>Operations on backend. 'command' can be one of :
<itemizedlist>
<listitem><para>close: unload 'backend'.
<emphasis>If you have no backend, or if backend is in use, the server will be in an unstable state !
</emphasis></para></listitem>
<listitem><para>commit: commits change to backend in a synchronous way. After the command,
you can shutdown or reload the server in a safe way</para></listitem>
<listitem><para>init: loads a new backend.
<emphasis>NO verifications are made - be sure of what you are doing !</emphasis></para></listitem>
<listitem><para>reload: close and init a backend, <emphasis>without commiting it</emphasis>.
This command allows you to modify backend and reload modifications.
<emphasis>Modifications should be made carefully, especially if users are loggued !
</emphasis></para></listitem>
</itemizedlist>
Backend name is the short name of the backend, not the name of the file (e.g:
<quote>plaintext</quote>, <quote>mysql</quote>).
<screen>site backend commit plaintext</screen>
<emphasis>This is a DANGEROUS command</emphasis></para>
</listitem>
</varlistentry>

<varlistentry id='site_chacl'><term>
site chacl &lt;user&gt; &lt;mode&gt; &lt;file&gt; [&lt;file2&gt; ...]
</term>
<listitem>
<para>Change access rights on a file or directory for a specific user/group</para>
<para>Always prefer the <link linkend='site_chmod'>site chmod</link> command
when you can</para>
</listitem>
</varlistentry>

<varlistentry id='site_change'><term>
site change &lt;user&gt; &lt;field&gt; &lt;value&gt;
</term>
<listitem>
<para>Change a field for a user.
<informaltable id="table_changes">
<tgroup cols="2">
<tbody>
<row><entry>Field</entry><entry>Description</entry></row>

<row><entry>name</entry><entry>This will change the user's login name.
<emphasis>The modification is immediate, even if user is currently loggued !</emphasis></entry></row>
<row><entry>pass</entry><entry>This will change the user's password.
This is similar to the <link linkend='site_chpass'>site chpass</link> command</entry></row>
<row><entry>homedir</entry><entry>This will change the user's homedir.</entry></row>
<row><entry>tagline</entry><entry>User's tagline.
This is similar to the <link linkend='site_tagline'>site tagline</link> command</entry></row>
<row><entry>group</entry><entry>Add / remove user from group.
<link linkend='site_chgrp'>site chgrp</link> command is better, as it can
handle several group changes in one command</entry></row>
<row><entry>max_idle</entry><entry>Set the maximum idle time for this user.
See the <link linkend='site_idle'>site idle</link> command</entry></row>
<row><entry>perms</entry><entry>Set user's default perms (All: 0xffffffff, retrieve only:
0x03).
<emphasis>This command will change</emphasis></entry></row>
<row><entry>flags</entry><entry>Set user's flags.
This is similar to the <link linkend='site_flags'>site flags</link> command
For flags info see <link linkend='table_flags'>Flags Table</link>.</entry></row>
<row><entry>max_ul</entry><entry>Upstream bandwidth control in bytes/sec
(0 = Unlimited).</entry></row>
<row><entry>max_dl</entry><entry>Same but for downloads.</entry></row>
<row><entry>ratio</entry><entry>User ratio</entry></row>
<row><entry>num_logins</entry><entry>Maximum number of simultaneous logins.</entry></row>
</tbody>
</tgroup>
</informaltable>
</para>
<para>If you are a gadmin, you can only change users from your group (except homedir, flags, and groups).</para>
</listitem>
</varlistentry>

<varlistentry id='site_checkperm'><term>
site checkperm &lt;user&gt; &lt;file&gt; &lt;rights&gt;
</term>
<listitem>
<para>Check permission for a specific user.
</para>
<screen>site checkperm toto my_file RIGHT_RETR</screen>
<informaltable id="table_perms">
<tgroup cols="2">
<tbody>
<row><entry>Permission</entry><entry>Description</entry></row>

<row><entry>RIGHT_LIST</entry><entry>User can list files (directory)</entry></row>
<row><entry>RIGHT_RETR</entry><entry>User can retrieve file</entry></row>
<row><entry>RIGHT_STOR</entry><entry>User can upload file (directory) or can overwrite (file)</entry></row>
<row><entry>RIGHT_CWD</entry><entry>User can go into this directory</entry></row>
<row><entry>RIGHT_RNFR</entry><entry>User can rename file</entry></row>
<row><entry>RIGHT_MKDIR</entry><entry>User can create dir at current location</entry></row>
<row><entry>RIGHT_RMDIR</entry><entry>User can delete dir at current location</entry></row>
</tbody>
</tgroup>
</informaltable>
</listitem>
</varlistentry>

<varlistentry id='site_chgrp'><term>
site chgrp &lt;user&gt; &lt;group1&gt; [&lt;group2&gt; ...]
</term>
<listitem>
<para>For each group in list, add user to group or removes it if he/she already
belongs to group.</para>
<screen>site chgrp toto guest admin </screen>
<para>This will add user <quote>toto</quote> to group <quote>admin</quote> and remove
<quote>toto</quote> from group <quote>guest</quote>, if user had group
<quote>guest</quote> before.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_chmod'><term>
site chmod &lt;user&gt; &lt;mode&gt; &lt;file1&gt; [&lt;file2&gt; ...]
</term>
<listitem>
<para>Change permissions for <quote>user</quote> on files. Permissions are unix-like.
<screen>site chmod toto rwx dir1</screen>
is equivalent to
<screen>site chmod toto 755 dir1</screen>
</para>
</listitem>
</varlistentry>

<varlistentry id='site_chown'><term>
site chown &lt;user&gt; &lt;file1&gt; [&lt;file2&gt; ...]
</term>
<listitem>
<para>Change file owner
<screen>site chown toto dir1</screen>
This will give dir1 to user <quote>toto</quote>,
<emphasis>but not its content !</emphasis>
</para>
</listitem>
</varlistentry>

<varlistentry id='site_chpass'><term>
site chpass &lt;user&gt; &lt;password&gt;
</term>
<listitem>
<para>Change user password.</para>
<screen>ex: site chpass toto newpassword</screen>
<para>This will change the password to 'newpassword' for the user 'toto'.</para>
<para>% denotes any password</para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_chratio'><term>
site chratio &lt;user&gt; &lt;ratio&gt;
</term>
<listitem>
<para>Change user ratio</para>
<screen>ex: site chratio toto 3</screen>
<para>This will change the ratio to 1:3 for the user 'toto'.</para>
<para>A ratio of 0 means no ratio (leech access).</para>
<para>If you are a gadmin, you can only change users from your group. To give a ratio
of 0 you need to have a free leech slot. If a gadmin sets back a ratio from
0 to a non-zero value, he gets back his leech slot.</para>
</listitem>
</varlistentry>

<varlistentry id='site_close'><term>
site close
</term>
<listitem>
<para>Close server for everyone except siteops.</para>
<para>This is mainly designed to temporarily close server for maintenance.</para>
<para>See the <link linkend='site_reopen'>site reopen</link> command</para>
</listitem>
</varlistentry>

<varlistentry id='site_delip'><term>
site delip &lt;user&gt; &lt;ip/slot&gt;
</term>
<listitem>
<para>Delete ip from user. You can also use the ip number (given by
<quote>site who</quote>).
<screen>site delip toto 127.0.0.1</screen>
This will remove the ip <quote>127.0.0.1</quote> from user
<quote>toto</quote>.
<screen>site delip toto 1</screen>
This will remove ip #1 in ip list from user <quote>toto</quote>
</para>
<para><quote>ip</quote> can contain wildcards, but they are
<emphasis>not</emphasis> interpreted.
<screen>site delip toto 127.*</screen>
This will remove the exact ip <quote>127.*</quote>, and not all ip
beginning by <quote>127.</quote>
</para>
<para>If an user has no authorized ip, he cannot login</para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_deluser'><term>
site deluser &lt;user&gt;
</term>
<listitem>
<para>
Delete a user, may be readded with site READD
</para>
<screen>site deluser toto</screen>
<para>
This will set the flag DELETED (D) for the user 'toto'.
In order to fully delete this user you will need to do a 'site purge'
</para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_flags'><term>
site flags [&lt;user&gt;]
</term>
<listitem>
<para>Display a user's flags.</para>
<screen>site flags</screen>
<para>This will show your own flags</para>
<screen>site flags toto</screen>
<para>This will show flags of user toto</para>
<informaltable id="table_flags">
<tgroup cols="3">
<tbody>
<row><entry>Flagname</entry><entry>Flag</entry><entry>Description</entry></row>

<row><entry>SITEOP</entry><entry>O</entry><entry>User is siteop</entry></row>
<row><entry>GADMIN</entry><entry>G</entry><entry>User is groupadmin of his/her
first public group<superscript>*</superscript></entry></row>
<row><entry>DELETED</entry><entry>D</entry><entry>User is deleted</entry></row>
<row><entry>IDLER</entry><entry>I</entry><entry>User is allowed to idle forever</entry></row>
<row><entry>SEE_IP</entry><entry>s</entry><entry>User is allowed to see other's ip</entry></row>
<row><entry>SEE_HOME</entry><entry>t</entry><entry>User is allowed to see other's home</entry></row>
<row><entry>HIDDEN</entry><entry>H</entry><entry>User will not appear in site who</entry></row>
<row><entry>TLS</entry><entry>k</entry><entry>User will is forced to use TLS/SSL connections</entry></row>
<row><entry>ANONYMOUS</entry><entry>A</entry><entry>User cannot make any modifications</entry></row>
</tbody>
</tgroup>
</informaltable>
<para>*NOTE* If you have flag O then you do NOT want flag G</para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_free'><term>
site free
</term>
<listitem>
<para>Show free space in the current dir.</para>
</listitem>
</varlistentry>

<varlistentry id='site_ginfo'><term>
site ginfo &lt;group&gt;
</term>
<listitem>
<para>Show detailed info on a group.</para>
<screen>site gsinfo idlers</screen>
<para>This will show detailed info (members, uploaded/downloaded files) on group 'idlers'</para>
</listitem>
</varlistentry>

<varlistentry id='site_grpadd'><term>
site grpadd &lt;group&gt; [&lt;backend&gt;]
</term>
<listitem>
<para>
Add a group. (Note: only siteops can add groups).
</para>
<para>
Group's defaultpath is determined using the value 'default_home' of your group, or
your homedir if you have no group.
</para>
<para>
You MUST check all values after.
<screen>ex: site grpadd newgroup</screen>
</para>
</listitem>
</varlistentry>

<varlistentry id='site_grpaddip'><term>
site grpaddip &lt;group&gt; &lt;ip&gt;
</term>
<listitem>
<para>Add IP to a group.
<screen>site addip idlers 127.*</screen>
This will allow users from group <quote>idlers</quote> to connect from all ip
beggining by <quote>127.</quote>
</para>
<para><emphasis>NOTE: ident is currently NOT supported, but is planned for next
release</emphasis></para>
</listitem>
</varlistentry>

<varlistentry id='site_grpdel'><term>
site grpdel &lt;group&gt;
</term>
<listitem>
<para>
Delete a group
</para>
<screen>site grpdel idlers</screen>
<para>
Unlike <link linkend='site_deluser'>site deluser</link>, the deletion is definitive
(you can't readd deleted groups, so be carefull).
</para>
</listitem>
</varlistentry>

<varlistentry id='site_grpdelip'><term>
site grpdelip &lt;group&gt; &lt;ip/slot&gt;
</term>
<listitem>
<para>Delete ip from group. You can also use the ip number (given by
<link linkend='site_gsinfo'>site gsinfo</link>).
<screen>site grpdelip idlers 127.0.0.1</screen>
This will remove the ip <quote>127.0.0.1</quote> from group
<quote>idlers</quote>.
<screen>site grpdelip idlers 1</screen>
This will remove ip #1 in ip list from group <quote>idlers</quote>
</para>
<para><quote>ip</quote> can contain wildcards, but they are
<emphasis>not</emphasis> interpreted.
<screen>site grpdelip idlers 127.*</screen>
This will remove the exact ip <quote>127.*</quote>, and not all ip
beginning by <quote>127.</quote>
</para>
</listitem>
</varlistentry>

<varlistentry id='site_grpratio'><term>
site grpratio &lt;group&gt; &lt;ratio&gt;
</term>
<listitem>
<para>Change group ratio</para>
<screen>ex: site grpratio idlers 3</screen>
<para>This will change the ratio to 1:3 for the group 'idlers'.</para>
<para>A ratio of 0 means no ratio (leech access).</para>
<para>Group ratio is used only when adding users in this group</para>
</listitem>
</varlistentry>

<varlistentry id='site_gsinfo'><term>
site gsinfo &lt;group&gt;
</term>
<listitem>
<para>Show system info on a group.</para>
<screen>site gsinfo idlers</screen>
<para>This will show system info (default home, ratio) on group 'idlers'</para>
</listitem>
</varlistentry>

<varlistentry id='site_help'><term>
site help
</term>
<listitem>
<para>
Display helpscreen.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_idle'><term>
site idle [&lt;idletime&gt;]
</term>
<listitem>
<para>
This sets your idle-time (the amount of time you can be online without
doing something) for this session only (unless commited to backend).
Max idle-time is 7200 sec.</para>
<screen>site idle</screen>
<para>This will show your current idle-time settings</para>
<screen>site idle 3600</screen>
<para>This will set your idle-timeout to 3600 sec.</para>
<para><quote>site idle 0</quote> for users that have the idle flag (I)
will allow them to idle forever.</para>
</listitem>
</varlistentry>

<varlistentry id='site_invite'><term>
site invite &lt;irc_nick&gt;
</term>
<listitem>
<para>Tells the sitebot to invite <emphasis>irc_nick</emphasis> on sitebot's channel.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_kick'><term>
site kick &lt;user&gt;
</term>
<listitem>
<para>Kick a user off the site.</para>
<screen>site kick toto</screen>
<para>This will kill all connections for the user 'toto'</para>
</listitem>
</varlistentry>

<varlistentry id='site_kill'><term>
site kill &lt;pid&gt;
</term>
<listitem>
<para>Kill a PID</para>
<screen>site kill 345</screen>
<para>This will kill pid #345 (if it belongs to a glftpd user)</para>
</listitem>
</varlistentry>

<varlistentry id='site_purge'><term>
site purge [&lt;user&gt;]
</term>
<listitem>
<para>Remove deleted users, site READD will not work for purged users.</para>
<para>If run without arguments, purge ALL deleted users</para>
<screen>site purge toto</screen>
<para>This will erase definitively user 'toto' (only if it has been deleted).</para>
<para>If you are a gadmin, you can only purge users from your group (that is,
if you are giving access to this command in your config file).</para>
</listitem>
</varlistentry>

<varlistentry id='site_readd'><term>
site readd &lt;user&gt;
</term>
<listitem>
<para>Re-add a user.</para>
<screen>site readd toto</screen>
<para>This will remove the DELETED flag for user 'toto'</para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_reload'><term>
site reload
</term>
<listitem>
<para>Reload config file.</para>
<screen>site reload</screen>
<para>This will reload config file (wzd.cfg by default)</para>
<para><emphasis>This is a DANGEROUS command</emphasis></para>
</listitem>
</varlistentry>

<varlistentry id='site_reopen'><term>
site reopen
</term>
<listitem>
<para>Re-open server for everyone.</para>
<para>Usefull after server has been closed with the <link linkend='site_close'>site close</link> command</para>
</listitem>
</varlistentry>

<varlistentry id='site_rules'><term>
site rules
</term>
<listitem>
<para>Display local site rules.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_shutdown'><term>
site shutdown
</term>
<listitem>
<para>
Shutdown the server. Users that are currently loggued are not kicked, and your
connection is not closed. You will need to start the server on the machine.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_swho'><term>
site swho
</term>
<listitem>
<para>
Shows detailed information about users online.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_tagline'><term>
site tagline [&lt;tagline&gt;]
</term>
<listitem>
<para>Shows/Sets your tagline</para>
<screen>site tagline</screen>
<para>This will show your current tagline</para>
<screen>site tagline my new tagline</screen>
<para>This will set your tagline to 'my new tagline'</para>
<para>If you are a gadmin, you can only change users from your group.</para>
</listitem>
</varlistentry>

<varlistentry id='site_user'><term>
site user &lt;user&gt;
</term>
<listitem>
<para>Show detailed informations for a user.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_users'><term>
site users
</term>
<listitem>
<para>List users and shows their group and detailed informations
</para>
</listitem>
</varlistentry>

<!-- site utime is not documented -->

<varlistentry id='site_uptime'><term>
site uptime
</term>
<listitem>
<para>
Display server uptime.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_version'><term>
site version
</term>
<listitem>
<para>
Display server version.
</para>
</listitem>
</varlistentry>

<varlistentry id='site_who'><term>
site who
</term>
<listitem>
<para>
Show users online.
</para>
</listitem>
</varlistentry>

</variablelist>

</chapter>
